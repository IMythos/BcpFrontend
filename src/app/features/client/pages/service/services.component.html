<main class="w-full bg-gray-50 min-h-screen">
  <client-header></client-header>

  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-orange-600 mb-6">Pagos de Servicios</h1>

    @if (errorMessage && !selectedPaymentId) {
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ errorMessage }}
      </div>
    }

    @if (successComprobante) {
      <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8 shadow-sm">
        <h3 class="text-xl font-bold text-green-700 mb-2 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
          ¡Pago Exitoso!
        </h3>
        <div class="grid grid-cols-2 gap-4 text-sm text-gray-700">
          <p><strong>Servicio:</strong> {{ successComprobante.servicio }}</p>
          <p><strong>Monto:</strong> S/ {{ successComprobante.montoPagado | number:'1.2-2' }}</p>
          <p><strong>Fecha:</strong> {{ successComprobante.fecha }}</p>
          <p><strong>Código Auth:</strong> {{ successComprobante.codigoAutorizacion }}</p>
        </div>
      </div>
    }

    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="p-4 border-b bg-gray-100 flex justify-between items-center">
        <h2 class="font-semibold text-gray-700">Deudas Pendientes</h2>
        <button (click)="loadPendingPayments()" class="text-orange-600 hover:text-orange-800 text-sm font-medium">
          Actualizar
        </button>
      </div>

      @if (isLoading && pendingPayments.length === 0) {
        <div class="p-8 text-center text-gray-500">Cargando pagos...</div>
      } @else if (pendingPayments.length === 0) {
        <div class="p-8 text-center text-gray-500">No tienes pagos pendientes en este momento.</div>
      } @else {
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
              <tr class="bg-gray-50 text-gray-600 text-sm">
                <th class="p-4">Servicio</th>
                <th class="p-4">Monto</th>
                <th class="p-4 text-right">Acción</th>
              </tr>
            </thead>
            <tbody>
              @for (pago of pendingPayments; track pago.idPago) {
                <tr class="border-t hover:bg-gray-50 transition">
                  <td class="p-4 font-medium text-gray-800">{{ pago.nombreServicio }}</td>
                  <td class="p-4 text-gray-600">S/ {{ pago.montoPendiente | number:'1.2-2' }}</td>
                  <td class="p-4 text-right">
                    <button 
                      (click)="initiatePayment(pago.idPago)"
                      class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium transition"
                    >
                      Pagar
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>

    @if (selectedPaymentId) {
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">Confirmar Pago</h3>
          <p class="text-gray-600 mb-4">Ingrese el ID de la cuenta desde donde desea debitar el monto.</p>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">ID Cuenta</label>
            <input 
              type="number" 
              [(ngModel)]="accountIdToPay" 
              class="w-full p-2 border rounded focus:ring-2 focus:ring-orange-500 outline-none"
              placeholder="Ej: 1"
            >
          </div>

          @if (errorMessage) {
            <div class="text-red-500 text-sm mb-4">{{ errorMessage }}</div>
          }

          <div class="flex justify-end gap-3">
            <button 
              (click)="cancelPayment()"
              class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded transition"
            >
              Cancelar
            </button>
            <button 
              (click)="confirmPayment()"
              [disabled]="isLoading || !accountIdToPay"
              class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium disabled:opacity-50 transition flex items-center"
            >
              @if (isLoading) {
                <span>Procesando...</span>
              } @else {
                <span>Confirmar Pago</span>
              }
            </button>
          </div>
        </div>
      </div>
    }

  </div>
</main>